# Функциональное описание Whale Bot v3.0 (Unicorn Portfolio Edition)

## 1. Введение
Whale Bot v3.0 — это автономный торговый робот для Polymarket, предназначенный для разгона малого депозита ($20 -> $1000). 

**Ключевое отличие:** Бот не просто копирует сделки, а управляет "Unicorn Portfolio" — виртуальным портфелем, который имитирует реальную торговлю с учетом комиссий, проскальзывания и риск-менеджмента.

## 2. Основные команды

| Команда | Описание |
|:---|:---|
| `/start` | Инициализация пользователя и создание портфеля. |
| `/menu` | Показать дашборд портфеля (Баланс, PnL, Активные сделки). |
| `/status` | **System Health Check:** Аптайм, память, статус базы и API. |
| `/reset` | Сброс портфеля к начальным $20 (для рестарта челленджа). |
| `/mining` | (Admin) Управление сбором данных для ML. |

## 3. Ключевые функции безопасности (Safety First)

### 3.1. Pre-Flight Price Check (Защита от проскальзывания)
Перед тем как скопировать сделку кита, бот делает "Pre-Flight" запрос текущей цены.
- Если цена кита $0.50, а текущая цена $0.60 (+20%), бот **отменяет** сделку.
- Допустимое проскальзывание: 5%.

### 3.2. Copy Sell (Emergency Exit)
Если кит, за которым мы повторили сделку, продает свои акции:
- Бот мгновенно продает нашу позицию.
- Это защищает от ситуаций, когда кит "переобулся" или фиксирует убыток.

### 3.3. Tilt Breaker (Защита от тильта)
Если кит совершил 3 убыточные сделки подряд:
- Бот временно перестает его копировать.
- Статус кита меняется на "On Tilt".

### 3.4. Resolution Checker (Авто-расчет)
Бот автоматически проверяет статус рынков каждые 5 минут.
- Если рынок закрылся, бот рассчитывает PnL.
- Выигрыш зачисляется на баланс, проигрыш списывается.
- Пользователь получает уведомление о результате.

## 4. Логика принятия решений

### 4.1. Фильтрация Сигналов
Бот анализирует каждую сделку в реальном времени:
1. **Value Filter:** Сделки < $50 игнорируются (шум).
2. **Whale Score:** Рассчитывается рейтинг кита (0-100) на основе его истории (PnL, Winrate).
3. **Honest Math:** Используется нижняя граница доверительного интервала (Wilson Score), а не просто % побед.

### 4.2. Режимы работы
- **Watch Mode (Наблюдение):** Если Score кита высокий (70+), но недостаточный для ставки, бот присылает уведомление "Watch List".
- **Action Mode (Ставка):** Если Score > 80 и цена проходит проверку, бот совершает виртуальную ставку.

## 5. Интеграции

- **Polymarket Data API:** Поток сделок в реальном времени.
- **Polymarket CLOB API:** Проверка актуальных цен и статусов рынков.
- **Goldsky GraphQL:** Глубокий анализ истории кошельков.
- **Telegram Bot API:** Интерфейс управления.
