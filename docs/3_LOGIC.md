# –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞

## 1. –¢–∏–ø–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π –ê: –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–π —Å–¥–µ–ª–∫–∏
1. **–í—Ö–æ–¥:** –ü–æ–ª—É—á–µ–Ω –æ–±—ä–µ–∫—Ç —Å–¥–µ–ª–∫–∏ –æ—Ç API.
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –≤–∞–ª–∏–¥–µ–Ω (`0x...`, –±–µ–∑ `zero/null/undefined`)?
   - –°–¥–µ–ª–∫–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ ID)? -> –°–±—Ä–æ—Å.
3. **–û–±–æ–≥–∞—â–µ–Ω–∏–µ:**
   - –î–ª—è —Å–¥–µ–ª–æ–∫ < $50 –∏—Å—Ç–æ—Ä–∏—è –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è (—ç–∫–æ–Ω–æ–º–∏—è –∫–≤–æ—Ç), —Å—Ç–∞—Ç—É—Å `skipped_low_value`.
   - –ò–Ω–∞—á–µ: –∑–∞–ø—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ—à–µ–ª—å–∫–∞ (—Å –∫—ç—à–µ–º 60 –º–∏–Ω –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —Å–∫–æ—Ä–æ—Å—Ç–∏).
   - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (`Lag`).
4. **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:**
   - –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (–ö–∏—Ç/–£–º–Ω—ã–π –ö–∏—Ç/–•–æ–º—è–∫).
   - –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ Honest Math.
5. **–†–∞—Å—Å—ã–ª–∫–∞:**
   - –¶–∏–∫–ª –ø–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å `active=1`.
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
   - –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ -> –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ -> –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram -> –ó–∞–ø–∏—Å—å –≤ `user_signal_logs`.

### –°—Ü–µ–Ω–∞—Ä–∏–π –ë: –ó–∞–∫—Ä—ã—Ç–∏–µ —Ä—ã–Ω–∫–∞ (Forward Testing)
1. **–¢—Ä–∏–≥–≥–µ—Ä:** –¢–∞–π–º–µ—Ä (–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω).
2. **–í—ã–±–æ—Ä–∫–∞:** –í—Å–µ —Å–∏–≥–Ω–∞–ª—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `OPEN`.
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ó–∞–ø—Ä–æ—Å –∫ Polymarket API –ø–æ `condition_id`.
4. **–£—Å–ª–æ–≤–∏–µ:** –†—ã–Ω–æ–∫ –∑–∞–∫—Ä—ã—Ç (`closed: true`)?
   - **–ù–µ—Ç:** –ü—Ä–æ–ø—É—Å–∫.
   - **–î–∞:**
     - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è.
     - –†–∞—Å—á–µ—Ç ROI (—Å —É—á–µ—Ç–æ–º –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏—è).
     - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–≥–Ω–∞–ª–∞ –Ω–∞ `CLOSED`.
     - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –≤ `user_signal_logs`.

## 2. State Machine (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥)

–°–æ—Å—Ç–æ—è–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (`userStates` –æ–±—ä–µ–∫—Ç –≤ `index.js`).

| –°–æ—Å—Ç–æ—è–Ω–∏–µ | –ü–µ—Ä–µ—Ö–æ–¥ –∏–∑ | –£—Å–ª–æ–≤–∏–µ –≤—ã—Ö–æ–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ |
|:---|:---|:---|:---|
| `idle` | (start) | –ö–æ–º–∞–Ω–¥–∞ / –ö–Ω–æ–ø–∫–∞ | - |
| `waiting_min_bet` | –ö–Ω–æ–ø–∫–∞ "üí∞ –ú–∏–Ω. —Å—Ç–∞–≤–∫–∞" | –í–≤–æ–¥ —á–∏—Å–ª–∞ | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `min_bet` |
| `waiting_winrate_min` | –ö–Ω–æ–ø–∫–∞ "üéØ –ú–∏–Ω. –≤–∏–Ω—Ä–µ–π—Ç" | –í–≤–æ–¥ 0-100 | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ |
| `waiting_feedback` | –ö–æ–º–∞–Ω–¥–∞ `/feedback` | –õ—é–±–æ–π —Ç–µ–∫—Å—Ç | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ |

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –õ—é–±–∞—è –∫–æ–º–∞–Ω–¥–∞, –Ω–∞—á–∏–Ω–∞—é—â–∞—è—Å—è —Å `/`, –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –µ–≥–æ –≤ `idle`.*

## 3. –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Hard Filters (–ó–∞—â–∏—Ç–∞ –î–µ–ø–æ–∑–∏—Ç–∞):**
   - **SELL –∑–∞–ø—Ä–µ—â—ë–Ω:** –í—Å–µ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î. –í—ã—è–≤–ª–µ–Ω–æ: 10% –≤–∏–Ω—Ä–µ–π—Ç –Ω–∞ SELL.
   - **Price Cap > 0.75:** –§–∞–≤–æ—Ä–∏—Ç—ã —É–±—ã—Ç–æ—á–Ω—ã (-27% ROI). –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—ã—Å–æ–∫–∏–µ —Ü–µ–Ω—ã.
   - **Min Value $50:** –°–¥–µ–ª–∫–∏ –º–µ–Ω—å—à–µ $50 –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å–∏–≥–Ω–∞–ª—ã (–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ CSV).
   - –õ–æ–≥–∏: `‚õî Hard Filter: SELL disabled / Price ... > 0.75 / Value $... < $50`

2. **–ü—Ä–∏–Ω—Ü–∏–ø "–ß–µ—Å—Ç–Ω–æ–π –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∏":**
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–µ —Å—Ä–µ–¥–Ω–µ–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ –ú–µ–¥–∏–∞–Ω–∞).
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å "—Å—ã—Ä–æ–π" –≤–∏–Ω—Ä–µ–π—Ç –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞.
   - –í—Å–µ–≥–¥–∞ —É—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–º–∏—Å—Å–∏–∏ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ PnL (Forward Test).

2. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API:**
   - –ß–∞—Å—Ç–æ—Ç–∞ –æ–ø—Ä–æ—Å–∞ —Å–¥–µ–ª–æ–∫: –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è, –Ω–æ –Ω–µ —á–∞—â–µ —á–µ–º —Ä–∞–∑ –≤ 2-3 —Å–µ–∫—É–Ω–¥—ã, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–∞–Ω–æ–≤.
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫: LRU-–∫—ç—à –Ω–∞ 2000 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö ID —Å–¥–µ–ª–æ–∫ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–µ–π.

3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è "–£–º–Ω–æ–≥–æ –ö–∏—Ç–∞":**
   - –°—Ç—Ä–æ–≥–æ–µ –ø—Ä–∞–≤–∏–ª–æ: `Total PnL > $5000` AND `Median PnL > 0` AND `LowerBound Winrate > 40`.
   - –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –∂–µ—Å—Ç–∫–æ –∑–∞—à–∏—Ç–æ –≤ –∫–æ–¥–µ (`whale_logic.js`) –¥–ª—è –∑–∞—â–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤.

### 3.1. –†–µ–∂–∏–º—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

- **Smart Mode:** –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã Honest Math ‚Äî –æ–±—â–∏–π PnL, –º–µ–¥–∏–∞–Ω–Ω—ã–π PnL –∏ –Ω–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –≤–∏–Ω—Ä–µ–π—Ç–∞ (Wilson CI). –°–∏–≥–Ω–∞–ª—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—Å–µ—Ö —É—Å–ª–æ–≤–∏–π.
- **Custom Mode (–¢–∏–ø: –í—Å–µ):** –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ—Ä–æ–≥–∏ ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—â–∏–π PnL (`min_pnl_total`) –∏ –¥–∏–∞–ø–∞–∑–æ–Ω —Å—ã—Ä–æ–≥–æ –≤–∏–Ω—Ä–µ–π—Ç–∞ (`filter_winrate_min_percent`/`max`). –ú–µ–¥–∏–∞–Ω–Ω—ã–π PnL –∏ CI‚Äë–≤–∏–Ω—Ä–µ–π—Ç –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è. –≠—Ç–æ –¥–∞—ë—Ç –≥–∏–±–∫–æ—Å—Ç—å, –Ω–æ –º–æ–∂–µ—Ç —Å–Ω–∏–∂–∞—Ç—å —Å—Ç—Ä–æ–≥–æ—Å—Ç—å –æ—Ç–±–æ—Ä–∞.

### 3.2. –†–∞—Å—á—ë—Ç ROI (Forward Testing)

- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω–æ–π —Ü–µ–Ω—ã `entry_price` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª –ø–æ–º–µ—á–∞–µ—Ç—Å—è `ERROR` –∏ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Ä–∞—Å—á—ë—Ç–∞—Ö ROI –Ω–∞ —É—Ä–æ–≤–Ω–µ `signals`.
- –î–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤ (`user_signal_logs`) –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è —Ü–µ–Ω–∞ –¥–∞—ë—Ç ROI = 0% (–∑–∞—â–∏—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π), —á—Ç–æ–±—ã –Ω–µ –∏—Å–∫–∞–∂–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ç—ã.
- **Dual ROI Modes (env `ROI_MODE`):**
  - **`realistic` (default):** –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö Polymarket: 0% global fee, 0.01% US taker, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π spread –∏ size impact.
  - **`conservative`:** Stress-test —Ä–µ–∂–∏–º —Å 50x safety margin (0.5% base slippage, cap 10%).
- –ú–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `applyRealisticSlippage()` –∏–ª–∏ `applyConservativeSlippage()` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ—Ñ–æ–ª—Ç—ã —Ü–µ–Ω—ã.

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –û—à–∏–±–∫–∏ GraphQL (–Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏) -> –°–¥–µ–ª–∫–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–∫–∞–∑).
   - –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ Telegram (—é–∑–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞) -> –§–ª–∞–≥ `active` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 0.
